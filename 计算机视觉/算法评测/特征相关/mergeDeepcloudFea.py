import re
import sys
import os
import base64
import numpy as np
import math

def array2feature(array):
    aList = [eval(i) for i in array.split(" ")]
    featureFloat = np.array(aList,dtype=np.float32)
    array = np.array(featureFloat)
    #array = array/math.sqrt(2)
    feature = base64.b64encode(array)

    return feature

fname = sys.argv[1] # feature file
cname = sys.argv[2] # csv
eList = [] # list to keep record of feature
fDict = {}
with open(fname) as fn:
    for line in fn:
        img, fea = line.strip(",\n").split(";")
        img = os.path.basename(img)
        fea = array2feature(fea)
        if img in eList:
            continue
        else:
            eList.append(img)
            fDict[img] = fea

with open('new.' + cname, 'w') as fw:
    with  open(cname) as fn:
        for line in fn:
            line = line.strip("\r\n")
            match = re.search('"http(.*?)"', line, re.DOTALL)
            name = os.path.basename(match.group(1))
            fw.write('{},"{}"{}'.format(line,fDict[name],os.linesep))
            
            
            
*****************
输入要求:
root@deepface-19:/data/zhouping/scripts/deepcloud# head -1 feature.txt img.csv 
==> feature.txt <==
xiushuijie_dc/images/606f9662-b625-4f5d-ac47-14da8fe8f1a1;-0.0173514,0.103305,0.0906128,-0.0583199,0.0652283,0.0144595,-0.0187973,0.0263484,0.00562313,0.0173514,-0.046431,-0.0631397,0.017994,-0.0170301,0.0825797,0.0597659,-0.0141382,-0.0586412,-0.101377,-0.0330962,0.0319715,-0.0311682,0.0165481,-0.0796878,0.00257057,0.0176727,0.0187973,0.0205646,0.100574,-0.0285976,-0.0163874,-0.0425751,-0.0795272,0.0774386,-0.0456277,0.0168694,0.0213679,-0.0875602,-0.0755106,0.0674776,-0.00980032,0.0134955,-0.0134955,0.0196006,-0.0751893,-0.0240991,-0.00321322,0.027473,-0.00353454,0.0491622,-0.0160661,0.100252,-0.0163874,-0.000642644,-0.0411292,-0.105715,-0.109731,0.0322928,0.0335781,0.00514115,0.0403259,0.0205646,0.0221712,-0.00690842,0.000321322,0.0268304,0.0125316,0.000642644,0.00449851,0.0305256,0.0123709,0.0446637,-0.0907734,0.0036952,0.0970392,-0.038398,-0.0787239,-0.0567133,0.0231352,-0.0327748,0.0213679,-0.0441818,0.0340601,0.0539821,0.029401,0.0641037,-0.0428965,-0.0477163,0.0616938,0.0504475,0.00899701,0.0509295,0.027955,-0.0398439,0.0428965,0.0102823,0.0228139,0.0543034,-0.094308,-0.0216892,0.0808124,-0.0660316,0.0896488,0.0674776,0.0412899,-0.0539821,0.0526968,0.0350241,0.0567133,-0.00562313,0.0657103,-0.0385586,-0.0102823,0.0205646,0.0197613,0.037434,-0.0213679,0.00819371,-0.0273124,-0.00385586,0.0732614,0.00771172,0.0163874,0.0779205,-0.0441818,0.0615331,-0.017512,-0.0604085,0.0626578,0.0589626,0.0232958,0.0493229,-0.0117282,0.0591232,-0.0208859,-0.0706908,0.0472343,0.0750287,-0.0657103,0.0676382,-0.0975212,0.0594445,-0.00803305,-0.00931833,-0.00610512,-0.0837043,-0.123709,0.0535001,-0.121138,-0.00819371,-0.0493229,0.0257057,0.0130135,-0.0228139,-0.0767959,-0.0808124,0.0996098,0.0565526,-0.0586412,-0.00706908,0.018958,-0.0290796,0.0657103,0.01944,0.0282763,0.0218499,0.092862,0.0433784,0.0311682,-0.00947899,0.0946293,-0.065389,-0.0213679,-0.0147808,-0.0483589,0.111499,0.0647464,0.0695662,-0.0176727,0.0131742,0.110856,0.0414505,0.0700482,-0.00947899,-0.0353454,0.00337388,0.0669956,-0.0589626,-0.0335781,-0.000321322,-0.0645857,0.0245811,0.0367914,0.0128529,-0.018476,0.0449851,-0.0718154,-0.0167087,-0.0138168,-0.0628184,-0.0192793,0.0975212,-0.010443,0.0265091,0.0766353,0.0200826,-0.0432178,0.0287583,0.109089,-0.0131742,-0.00192793,-0.0419325,0.0311682,0.07535,-0.0348634,0.0131742,-0.0122102,0.0700482,-0.0332568,-0.0991278,-0.0711728,-0.0779205,0.0403259,0.0106036,-0.0845077,0.0377553,0.00385586,0.0504475,0.0112463,0.0388799,0.103948,-0.0144595,-0.0597659,-0.00947899,-0.0393619,-0.0700482,0.0689235,-0.0372733,0.0417718,-0.0804911,-0.0427358,-0.0909341,0.0348634,0.000160661,0.00947899,0.0204039,-0.0430571,-0.0170301,-0.00947899,0.0247418,-0.0465917,-0.0253844,0.0382373,-0.00867569,-0.0326142,-0.0681202,-0.0560707,-0.0106036,-0.0735827,0.0207253,0.0168694,0.0634611,0.0636217,-0.0446637,0.0493229,-0.0523755,-0.0181547,-0.0657103,-0.0747073,-0.0544641,0.0247418,-0.00642644,-0.037916,-0.0536608,0.0417718,-0.00192793,0.0388799,0.0216892,0.0896488,-0.00192793,-0.0327748,0.0451457,0.0533394,-0.0102823,-0.0430571,0.0253844,0.0745467,-0.0457884,-0.0565526,-0.00208859,0.00240991,-0.0163874,0.027955,-0.056392,0.0311682,-0.0151021,0.0273124,0.00787239,0.0700482,-0.0380766,-0.0896488,-0.0456277,0.00771172,-0.0408079,0.0202433,-0.0118889,0.083383,-0.018476,0.0208859,0.00530181,-0.0433784,-0.00305256,-0.00176727,0.00642644,0.0170301,0.0329355,0.0538214,0.0163874,-0.106679,0.0125316,0.0560707,0.0694055,-0.0710121,0.113909,-0.00755106,0.0859536,0.0433784,-0.0514115,0.0403259,0.00273124,0.0144595,-0.074868,0.136883,0.00433784,-0.0621758,-0.00835437,-0.0163874,-0.0795272,-0.0567133,-0.00642644,0.0406472,0.0420932,0.0618545,0.0618545,-0.0218499,0.00385586,-0.0207253,0.00787239,-0.0465917,0.0416112,0.0160661,-0.0747073,-0.0827404,-0.156644,-0.0226532,0.0155841,0.0633004,0.0398439,0.0436998,-0.0152628,0.0324535,-0.0446637,-0.0435391,0.0435391,-0.0931833,-0.0594445,0.00562313,0.0393619,-0.0142988,0.0607298,0.0875602,0.00851503,-0.0906128,0.0363094,0.0306862,0.0579986,-0.0202433,0.0592839,-0.0446637,0.0414505,-0.0122102,0.03647,-0.035988,-0.000481983,

==> img.csv <==
"1567591207452000000","4c935c46-ca47-4404-8c61-565e3de879fb_dg","3df46617-0760-4141-9bf2-cce93f7082b4_dg","http://ladder-v2test-1253924368.cos.ap-beijing.myqcloud.com/9dedbcc1-e5b5-4593-9b21-1ee3238f241e"
root@deepface-19:/data/zhouping/scripts/deepcloud# python mergeFea.py feature.txt img.csv 

*****************
